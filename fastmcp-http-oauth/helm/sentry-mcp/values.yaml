# Default values for sentry-mcp
# This is a YAML-formatted file.

replicaCount: 2

image:
  repository: sentry-mcp
  pullPolicy: IfNotPresent
  # Overrides the image tag whose default is the chart appVersion.
  tag: ""

imagePullSecrets: []
nameOverride: ""
fullnameOverride: ""

serviceAccount:
  # Specifies whether a service account should be created
  create: true
  # Annotations to add to the service account
  annotations: {}
  # The name of the service account to use.
  # If not set and create is true, a name is generated using the fullname template
  name: ""

podAnnotations: {}

podSecurityContext: {}
  # fsGroup: 2000

securityContext:
  readOnlyRootFilesystem: true
  runAsNonRoot: true
  runAsUser: 1000
  allowPrivilegeEscalation: false
  capabilities:
    drop:
      - ALL

service:
  type: ClusterIP
  port: 3000

ingress:
  enabled: false
  className: ""
  annotations: {}
    # kubernetes.io/ingress.class: nginx
    # kubernetes.io/tls-acme: "true"
  hosts:
    - host: sentry-mcp.local
      paths:
        - path: /
          pathType: ImplementationSpecific
  tls: []
  #  - secretName: sentry-mcp-tls
  #    hosts:
  #      - sentry-mcp.local

resources: {}
  #limits:
  #  cpu: 500m
  #  memory: 512Mi
  #requests:
  #  cpu: 100m
  #  memory: 128Mi

# Autoscaling configuration
autoscaling:
  enabled: false
  minReplicas: 2
  maxReplicas: 10
  targetCPUUtilizationPercentage: 80
  # targetMemoryUtilizationPercentage: 80

nodeSelector: {}

tolerations: []

affinity: {}

# Pod Disruption Budget
podDisruptionBudget:
  enabled: false
  # minAvailable: 1
  maxUnavailable: 1

# Health checks
livenessProbe:
  httpGet:
    path: /health
    port: http
  initialDelaySeconds: 10
  periodSeconds: 30
  timeoutSeconds: 10
  failureThreshold: 3

readinessProbe:
  httpGet:
    path: /health
    port: http
  initialDelaySeconds: 5
  periodSeconds: 10
  timeoutSeconds: 5
  failureThreshold: 3

# =============================================================================
# Configuration (non-secret values)
# =============================================================================
# You can either:
# 1. Set values directly here (a ConfigMap will be created)
# 2. Use an existing ConfigMap by setting existingConfigMap
# =============================================================================

# Use an existing ConfigMap instead of creating one
# If set, the config section below is ignored
existingConfigMap: ""

config:
  # Server configuration
  port: "3000"
  host: "0.0.0.0"
  baseUrl: ""  # Required: e.g., "https://mcp.example.com"

  # Sentry configuration
  sentryHost: ""  # Required: e.g., "sentry.io" or your self-hosted instance

  # Sentry OAuth Client ID (not secret, but paired with secret client_secret)
  sentryClientId: ""  # Required

  # Sentry OAuth scopes (comma-separated)
  # Default: org:read,project:read,project:write,team:read,team:write,event:write
  sentryScopes: ""

  # Redis/Valkey configuration
  redisUrl: "redis://valkey:6379"
  redisTls: "false"
  redisTlsRejectUnauthorized: "true"

  # OpenAI configuration (optional)
  openaiBaseUrl: ""

  # MCP documentation URL
  mcpUrl: "https://mcp.sentry.dev"

  # Logging level (debug, info, warn, error)
  logLevel: ""

  # Allowed redirect URI patterns (comma-separated)
  # Default: * (allow all)
  allowedRedirectUriPatterns: ""

# =============================================================================
# Secrets
# =============================================================================
# You can either:
# 1. Set values directly here (a Secret will be created) - NOT RECOMMENDED FOR PROD
# 2. Use an existing Secret by setting existingSecret
# =============================================================================

# Use an existing Secret instead of creating one
# The secret must contain the following keys:
#   - SENTRY_CLIENT_SECRET
#   - ENCRYPTION_KEY
#   - JWT_SIGNING_KEY
#   - OPENAI_API_KEY (optional)
existingSecret: ""

# Secret values (only used if existingSecret is not set)
# WARNING: Setting secrets in values.yaml is not recommended for production
# Use existingSecret instead
secrets:
  # Sentry OAuth client secret (required)
  sentryClientSecret: ""

  # Encryption key for token storage (required)
  # Generate with: openssl rand -base64 32
  encryptionKey: ""

  # JWT signing key for session tokens (required)
  # Generate with: openssl rand -base64 32
  jwtSigningKey: ""

  # OpenAI API key for AI-powered tools (optional)
  openaiApiKey: ""

# Redis authentication (if your Redis requires authentication)
# This is separate because it might be managed differently
redis:
  # Use an existing secret for Redis password
  existingSecret: ""
  # Key in the existing secret that contains the password
  existingSecretKey: "redis-password"
  # Or set the password directly (not recommended for production)
  password: ""

# =============================================================================
# Extra Environment Variables
# =============================================================================
# Add custom environment variables to the deployment.
# Useful for additional configuration not covered by the standard values.
# =============================================================================

# Extra environment variables (key-value pairs)
extraEnv: {}
  # Example:
  # MY_CUSTOM_VAR: "my-value"
  # FEATURE_FLAG: "enabled"

# Extra environment variables from ConfigMaps or Secrets
extraEnvFrom: []
  # Example:
  # - configMapRef:
  #     name: my-extra-config
  # - secretRef:
  #     name: my-extra-secrets

# Extra environment variables with full env var spec (for valueFrom, etc.)
extraEnvVars: []
  # Example:
  # - name: MY_SECRET_VAR
  #   valueFrom:
  #     secretKeyRef:
  #       name: my-secret
  #       key: secret-key
  # - name: MY_FIELD_REF
  #   valueFrom:
  #     fieldRef:
  #       fieldPath: metadata.namespace

# =============================================================================
# Custom CA Certificates
# =============================================================================
# Configure custom Certificate Authorities for TLS connections to internal
# services (e.g., self-hosted Sentry, internal Redis with custom certs).
#
# An init container will run update-ca-certificates and make the certificates
# available to the main container via a shared volume.
# =============================================================================

customCAs:
  # Enable custom CA certificate handling
  enabled: false

  # Use an existing ConfigMap containing CA certificates
  # The ConfigMap should have .crt files as keys (e.g., "my-ca.crt": "<PEM content>")
  existingConfigMap: ""

  # Or define certificates inline (only used if existingConfigMap is not set)
  # Each key should end with .crt and contain PEM-encoded certificate
  certificates: {}
    # Example:
    # my-internal-ca.crt: |
    #   -----BEGIN CERTIFICATE-----
    #   MIIDxTCCAq2gAwIBAgIQAqxcJmoLQJuPC3nyrkYldzANBgkqhkiG9w0BAQsFAMDC
    #   ...
    #   -----END CERTIFICATE-----
    # another-ca.crt: |
    #   -----BEGIN CERTIFICATE-----
    #   ...
    #   -----END CERTIFICATE-----
